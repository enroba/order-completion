<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Product Search</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f9fafb;
      color: #333;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 10px 15px 40px;
    }
    .top-center-container {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgb(0 0 0 / 0.1);
      padding: 30px 40px 40px;
      max-width: 760px;
      width: 100%;
      text-align: center;
    }
    h2 { margin-bottom: 24px; font-weight: 700; color: #222; }
    #inputsRow {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 20px 40px;
      margin-bottom: 28px;
    }
    label { font-weight: 600; color: #555; white-space: nowrap; user-select: none; }
    input[type="text"], input[type="number"] {
      padding: 10px 14px;
      font-size: 16px;
      border: 2px solid #ddd;
      border-radius: 8px;
      width: 280px;
      max-width: 100%;
      transition: border-color 0.3s ease;
      outline-offset: 2px;
      outline-color: transparent;
    }
    input[type="number"] { width: 90px; text-align: right; }
    input:focus { border-color: #007bff; outline-color: #007bff; box-shadow: 0 0 8px rgba(0,123,255,0.3); }
    #searchRow { margin-bottom: 32px; display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; }
    #productInput { flex: 1; min-width: 280px; max-width: 400px; border: 2px solid #ddd; border-radius: 8px; padding: 12px 16px; font-size: 17px; transition: border-color 0.3s ease; outline-offset: 2px; outline-color: transparent; }
    button {
      background-color: #007bff; color: #fff; border: none; font-weight: 600;
      padding: 12px 24px; font-size: 16px; border-radius: 8px; cursor: pointer; transition: background-color 0.3s ease; user-select: none; flex-shrink: 0;
    }
    button:hover { background-color: #0056b3; }
    button:active { background-color: #00408d; }
    #productResult {
      display: none;
      margin-top: 20px;
      max-width: 760px;
      margin-left: auto;
      margin-right: auto;
      gap: 30px;
      display: flex;
      justify-content: center;
      flex-wrap: nowrap;
      overflow-x: auto;
      padding-bottom: 10px;
      scrollbar-width: thin;
      scrollbar-color: #bbb transparent;
    }
    #productResult::-webkit-scrollbar { height: 8px; }
    #productResult::-webkit-scrollbar-thumb { background-color: #bbb; border-radius: 4px; }
    #productResult::-webkit-scrollbar-track { background: transparent; }
    .product-card { background: #fff; border-radius: 12px; padding: 20px 24px; box-shadow: 0 3px 12px rgb(0 0 0 / 0.07); width: 320px; box-sizing: border-box; flex-shrink: 0; text-align: left; display: flex; flex-direction: column; }
    .product-card h4 { margin-bottom: 14px; border-bottom: 2px solid #e3e6eb; padding-bottom: 6px; font-weight: 700; color: #007bff; }
    .variant-item { margin: 8px 0; padding: 6px 0; border-bottom: 1px solid #f0f1f4; font-family: 'Courier New', Courier, monospace; font-size: 15px; color: #444; line-height: 1.3; }
    .variant-item:last-child { border-bottom: none; }
    a { display: inline-block; margin-top: 18px; font-weight: 600; color: #007bff; text-decoration: none; font-size: 15px; transition: color 0.2s ease; }
    a:hover { text-decoration: underline; color: #0056b3; }
    .out-of-stock { color: red; font-weight: 600; }
    @media (max-width: 720px) { #productResult { flex-wrap: nowrap; max-width: 100%; } #inputsRow { gap: 15px 20px; } #productInput { max-width: 100%; } }
  </style>
</head>
<body>
  <div class="top-center-container" role="main" aria-label="Product Search">
    <h2>Search Product</h2>
    <div id="inputsRow">
      <label for="baseUrlInput">Base URL:</label>
      <input type="text" id="baseUrlInput" value="https://zarposhcollection.com/products/" />
      <label for="markupInput">% Markup:</label>
      <input type="number" id="markupInput" value="18" min="0" max="100" step="0.1" style="width: 90px;" />
    </div>
    <div id="searchRow">
      <input type="text" id="productInput" placeholder="Enter product handle (e.g. Cherry Blossom)" required />
      <button id="searchBtn">Search</button>
    </div>
    <div id="productResult" aria-live="polite" aria-atomic="true" role="region">
      <div id="originalPrices" class="product-card"></div>
      <div id="markedUpPrices" class="product-card"></div>
    </div>
  </div>

  <script>
    const searchBtn = document.getElementById('searchBtn');
    const productResult = document.getElementById('productResult');
    const inputField = document.getElementById('productInput');
    const baseUrlInput = document.getElementById('baseUrlInput');
    const markupInput = document.getElementById('markupInput');

    function formatPrice(num) {
      return num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    function fixImageUrl(url) {
      if (!url) return null;
      if (url.startsWith('//')) return 'https:' + url;
      if (url.startsWith('http://') || url.startsWith('https://')) return url;
      return url;
    }

    async function fetchProduct() {
      let baseUrl = baseUrlInput.value.trim();
      if (!baseUrl) { alert('Please enter the base URL.'); return; }
      if (!baseUrl.endsWith('/')) baseUrl += '/';

      let input = inputField.value.trim();
      if (!input) { alert('Please enter a product handle.'); return; }

      const handle = input.replace(/\s+/g, '-').toLowerCase();
      const apiUrl = `${baseUrl}${handle}.js`;

      productResult.style.display = 'flex';
      productResult.querySelector('#originalPrices').innerHTML = '<p>Loading...</p>';
      productResult.querySelector('#markedUpPrices').innerHTML = '';
      inputField.value = '';

      try {
        const res = await fetch(apiUrl);
        if (!res.ok) throw new Error('Product not found');
        const product = await res.json();

        const markupPercent = parseFloat(markupInput.value);
        if (isNaN(markupPercent) || markupPercent < 0) { alert('Please enter a valid positive markup percentage.'); return; }

        let productImage = null;
        if (product.image && product.image.src) productImage = fixImageUrl(product.image.src);
        else if (product.images && product.images.length > 0) productImage = fixImageUrl(product.images[0]);

        let originalList = '';
        if (productImage) originalList += `<img src="${productImage}" alt="${product.title}" style="width:150px;height:auto;border-radius:12px;margin-bottom:14px;" />`;
        originalList += '<h4>Available Variants & Prices:</h4>';
        product.variants.forEach(v => {
          const stockStatus = v.available ? '<span>In Stock</span>' : '<span class="out-of-stock">Out of Stock</span>';
          const compareAt = (v.compare_at_price && v.compare_at_price > v.price)
            ? `<strong>PKR ${formatPrice(v.price / 100)} / PKR ${formatPrice(v.compare_at_price / 100)}</strong>`
            : `<strong>PKR ${formatPrice(v.price / 100)}</strong>`;
          originalList += `<div class="variant-item">${v.title !== "Default Title" ? `<strong>${v.title}</strong> - ` : ""}${compareAt} — ${stockStatus}</div>`;
        });

        // MARKED-UP PRICE CORRECTED
        let markedUpList = '';
        if (productImage) markedUpList += `<img src="${productImage}" alt="${product.title}" style="width:150px;height:auto;border-radius:12px;margin-bottom:14px;" />`;
        markedUpList += `<h4>Prices + ${markupPercent}% Profit:</h4>`;
        product.variants.forEach(v => {
          const stockStatus = v.available ? '<span>In Stock</span>' : '<span class="out-of-stock">Out of Stock</span>';
          const markedUpPrice = v.price / (1 - markupPercent / 100);
          const compareAtMarkedUp = (v.compare_at_price && v.compare_at_price > v.price)
            ? `<strong>PKR ${formatPrice(markedUpPrice / 100)} / PKR ${formatPrice((v.compare_at_price / (1 - markupPercent / 100)) / 100)}</strong>`
            : `<strong>PKR ${formatPrice(markedUpPrice / 100)}</strong>`;
          markedUpList += `<div class="variant-item">${v.title !== "Default Title" ? `<strong>${v.title}</strong> - ` : ""}${compareAtMarkedUp} — ${stockStatus}</div>`;
        });

        productResult.querySelector('#originalPrices').innerHTML = originalList + `<a href="${baseUrl}${handle}" target="_blank">View on Website</a>`;
        productResult.querySelector('#markedUpPrices').innerHTML = markedUpList;

      } catch (err) {
        productResult.querySelector('#originalPrices').innerHTML = `<p style="color:red;">${err.message}</p>`;
        productResult.querySelector('#markedUpPrices').innerHTML = '';
      }
    }

    searchBtn.addEventListener('click', fetchProduct);
    inputField.addEventListener('keypress', e => { if (e.key === 'Enter') fetchProduct(); });
  </script>
</body>
</html>
